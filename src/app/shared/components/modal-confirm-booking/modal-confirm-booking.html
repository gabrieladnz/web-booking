<section class="modal-booking">
    <header class="modal-booking__header">
        <h1 class="modal-booking__title">
            @if (currentStep === 'booking') {
            Reservar hotel
            } @else {
            Detalhes do pagamento
            }
        </h1>
        <p class="modal-booking__subtitle">
            Você está reservando: <strong>{{ hotel.name }}</strong>
        </p>
        <button (click)="onClose()" class="modal-booking__close-button" aria-label="Fechar">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </header>

    <div class="modal-booking__content">
        <!-- PASSO 1: Detalhes da Reserva -->
        @if (currentStep === 'booking') {
        <form [formGroup]="bookingForm" (ngSubmit)="onConfirmBooking()" class="modal-booking__form">
            <!-- Detalhes da Estadia -->
            <div class="card">
                <h2 class="card__title">Detalhes da estadia</h2>
                <div class="card__grid card__grid--3">
                    <div class="form-group">
                        <label for="checkIn" class="form-label">Check-in</label>
                        <input id="checkIn" type="date" formControlName="checkIn" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="checkOut" class="form-label">Check-out</label>
                        <input id="checkOut" type="date" formControlName="checkOut" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="guests" class="form-label">Hóspedes</label>
                        <input id="guests" type="number" min="1" formControlName="guests" class="form-control">
                    </div>
                </div>
            </div>

            <!-- Hóspede Principal -->
            <div class="card" formGroupName="primaryGuest">
                <h2 class="card__title">Hóspede principal</h2>
                <div class="card__grid card__grid--2">
                    <div class="form-group">
                        <label for="firstName" class="form-label">Nome</label>
                        <input id="firstName" formControlName="firstName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="lastName" class="form-label">Sobrenome</label>
                        <input id="lastName" formControlName="lastName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="email" class="form-label">Email</label>
                        <input id="email" type="email" formControlName="email" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="phone" class="form-label">Telefone</label>
                        <input id="phone" formControlName="phone" class="form-control">
                    </div>
                    <div class="form-group card__grid-span-2">
                        <label for="document" class="form-label">CPF/Documento</label>
                        <input id="document" formControlName="document" class="form-control">
                    </div>
                </div>
            </div>

            <!-- Hóspedes Adicionais -->
            @if (bookingForm.get('guests')?.value > 1) {
            <div class="card" formArrayName="additionalGuests">
                <h2 class="card__title">Hóspedes adicionais</h2>
                @for (guestGroup of additionalGuests.controls; track $index) {
                <div [formGroupName]="$index" class="card__grid card__grid--3 additional-guest">
                    <div class="form-group">
                        <label class="form-label">Nome</label>
                        <input formControlName="firstName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sobrenome</label>
                        <input formControlName="lastName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Documento</label>
                        <input formControlName="document" class="form-control">
                    </div>
                </div>
                }
            </div>
            }

            <div class="card__footer">
                <button type="button" (click)="onClose()" class="button button--outline">Cancelar</button>
                <button type="submit" [disabled]="isConfirming" class="button button--primary">
                    @if (isConfirming) {
                    <span>Confirmando...</span>
                    } @else {
                    <span>Confirmar e ir para pagamento</span>
                    }
                </button>
            </div>
        </form>
        }

        <!-- PASSO 2: Pagamento -->
        @if (currentStep === 'payment') {
        <form [formGroup]="paymentForm" class="modal-booking__form">
            <div class="card">
                <h2 class="card__title">Informações de pagamento</h2>
                <div class="card__grid card__grid--2">
                    <div class="form-group card__grid-span-2">
                        <label for="cardHolder" class="form-label">Nome no cartão</label>
                        <input id="cardHolder" formControlName="cardHolder" class="form-control">
                    </div>
                    <div class="form-group card__grid-span-2">
                        <label for="cardNumber" class="form-label">Número do cartão</label>
                        <input id="cardNumber" formControlName="cardNumber" class="form-control"
                            placeholder="0000 0000 0000 0000">
                    </div>
                    <div class="form-group">
                        <label for="expiryDate" class="form-label">Validade (MM/AA)</label>
                        <input id="expiryDate" formControlName="expiryDate" class="form-control" placeholder="MM/AA">
                    </div>
                    <div class="form-group">
                        <label for="cvv" class="form-label">CVV</label>
                        <input id="cvv" formControlName="cvv" class="form-control" placeholder="123">
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card__title">Resumo do pedido</h3>
                <div class="summary">
                    <div class="summary__item">
                        <span>{{ calculateNights() }} noites x {{ hotel.pricePerNight | currency:'BRL' }}</span>
                        <span>{{ calculateTotal() | currency:'BRL' }}</span>
                    </div>
                    <div class="summary__total">
                        <span>Total</span>
                        <span>{{ calculateTotal() | currency:'BRL' }}</span>
                    </div>
                </div>
            </div>

            <div class="card__footer">
                <button type="button" (click)="onClose()" class="button button--outline">Cancelar</button>
                <button type="submit" [disabled]="isPaying" class="button button--primary">
                    @if (isPaying) {
                    <span>Processando...</span>
                    } @else {
                    <span (click)="onProcessPayment()">Pagar e finalizar reserva</span>
                    }
                </button>
            </div>
        </form>
        }
    </div>
</section>